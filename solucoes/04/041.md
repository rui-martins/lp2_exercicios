## Problema

41 - Considera a classe `NPC`, com três campos:

* `Strength`
* `Dexterity`
* `Charisma`

Existem duas classes concretas de `NPC`, nomeadamente `Orc` e `Human`. Os
primeiros têm ainda o campo `Endurance` e os últimos o campo `Wisdom`. Podem
existir vários NPCs num nível, sendo a especificação de níveis feita num
ficheiro de texto semelhante ao seguinte:

```text
NPC: Human
Strength: 78
Dexterity: 51
Charisma: 67
Wisdom: 33

NPC: Human
Strength: 44
Dexterity: 40
Charisma: 75
Wisdom: 71

NPC: Orc
Strength: 91
Dexterity: 83
Charisma: 29
Endurance: 49
```

Cria um programa que leia um ficheiro semelhante, cujo nome deve ser indicado
como 1º argumento na linha de comandos, e instancie os NPCs especificados no
ficheiro usando uma _simple factory_. Os vários NPCs instanciados podem ser
indicados no ecrã para fins de _debug_ (sugestão: criem e usem um método
`ToString()` para a classe `NPC` e respetivas classes derivadas). O programa
deve fazer uso de bons princípios de design de classes, _design patterns_
apropriados ao problema, devendo ainda verificar, usando exceções, possíveis
situações de erro (ficheiro não especificado, ficheiro não existe, ficheiro
com conteúdos inválidos/inesperados, etc).

> [Soluções](../solucoes/04/041.md)

## Solução

Formato utilizado no ficheiro: Field:Value

```cs
using System;
using System.Collections.Generic;
using System.IO;
namespace ex32_04
{
    class Program
    {
        static void Main(string[] args)
        {
            // Criar instância de ReadFromFile
            ReadFromFile readFromFile = new ReadFromFile();

            // Ler do ficheiro para lista de string organizada
            List<string> organizednpcInfo = readFromFile.ReadIntoList(args);

            // Criar lista de NPCs
            List<NPC> npcList = new List<NPC>();

            // Criar NPCs através da lista organizada 
            for (int i = 1; i <= organizednpcInfo.Count; i++)
            {
                // Assim que chegarmos a um múltiplo de 5, isto é,
                // o último valor do NPC que queremos adicionar,
                // adicionamos todos os campos correspondentes
                if (i % 5 == 0)
                {
                    npcList.Add(NPC.CreateNPC(
                        organizednpcInfo[i - 5],
                        Convert.ToInt32(organizednpcInfo[i - 4]),
                        Convert.ToInt32(organizednpcInfo[i - 3]),
                        Convert.ToInt32(organizednpcInfo[i - 2]),
                        Convert.ToInt32(organizednpcInfo[i - 1])));
                }
            }
            
            // Imprimir valores
            foreach (NPC npc in npcList)
            {
                Console.WriteLine(npc);
            }
        }
    }

    public class ReadFromFile
    {
        // O nosso ficheiro NPCGen.txt está situado no Desktop
        string path;

        public List<string> ReadIntoList(string[] args)
        {
            string[] npcInfo = null;
            string[] subStrings = null;
            List<string> organizednpcInfo = new List<string>();

            // Verificar se é passado apenas um argumento (o nosso ficheiro)
            if (args.Length != 1)
            {
                Console.WriteLine("ERROR. Invalid arguments.");
                Environment.Exit(1);
            }

            path = Path.Combine(
            Environment.GetFolderPath(Environment.SpecialFolder.Desktop),
            args[0]);

            // Verificar se o ficheiro existe
            try
            {
                // Tentamos ler todas as linhas
                npcInfo = File.ReadAllLines(path);

                // Percorremos o array com as linhas do ficheiro
                for (int i = 1; i <= npcInfo.Length; i++)
                {
                    // Se o campo que estamos a verificar é múltiplo de 6 
                    // (o espaço em branco entre diferentes valores)
                    if (i % 6 != 0)
                    {
                        // Separamos as strings em duas por : e
                        // metemos os dois valores em subStrings
                        subStrings = npcInfo[i - 1].Split(':');

                        // Se subStrings tiver mais que dois valores, mostramos erro
                        if (subStrings.Length != 2)
                        {
                            Console.WriteLine("Invalid file format. Correct format - Field: Value");
                            Environment.Exit(1);
                        }

                        // Passamos então cada valor à direita dos dois pontos
                        // Aplicamos Trim() para retirar o espaço
                        organizednpcInfo.Add(subStrings[1].Trim());
                    }
                }
            }

            // Aviso a apresentar caso o programa não encontre o ficheiro
            catch (FileNotFoundException e)
            {
                throw new FileNotFoundException("File not found!", e);
            }

            // Se a nossa lista contiver um número de valores diferente
            // de múltiplos de 5, então está errado e mostramos erro
            if (organizednpcInfo.Count % 5 != 0)
            {
                Console.WriteLine("Invalid file format.");
                Environment.Exit(1);
            }

            // Verificar se os campos Wisdom estão nos humanos 
            // e Endurance nos Ogres
            for (int i = 1; i <= organizednpcInfo.Count; i++)
            {
                if (i % 5 == 0)
                {
                    if (organizednpcInfo[i - 1] == "Wisdom"
                        && organizednpcInfo[i - 5] != "Human"
                        ||
                        organizednpcInfo[i - 1] == "Endurance"
                        && organizednpcInfo[i - 5] != "Orc")
                    {
                        Console.WriteLine("Invalid file format." +
                            "Orcs do not hold wisdom neither humans endurance");
                        Environment.Exit(1);
                    }
                }
            }

            return organizednpcInfo;
        }
    }

    public class NPC
    {
        protected string npcType;
        public int Strength { get; protected set; }
        public int Dexterity { get; protected set; }
        public int Charisma { get; protected set; }
        public static NPC CreateNPC(string type, int str, int dex, int chr, int special)
        {
            NPC npc = null;
            if (type.Equals("Orc"))
                npc = new Orc(type, str, dex, chr, special);
            else if (type.Equals("Human"))
                npc = new Human(type, str, dex, chr, special);
            return npc;
        }
        public override string ToString()
        {
            return $"I'm a {npcType}.";
        }
    }
    public class Orc : NPC
    {
        public int Endurance { get; }
        public Orc(string type, int str, int dex, int chr, int special)
        {
            npcType = type;
            Strength = str;
            Dexterity = dex;
            Charisma = chr;
            Endurance = special;
        }
        public override string ToString()
        {
            return $"{base.ToString()} " +
                $"My stats are: " +
                $"Strength: {Strength}, " +
                $"Dexterity: {Dexterity}, " +
                $"Charisma: {Charisma}, " +
                $"Endurance: {Endurance}";
        }
    }
    public class Human : NPC
    {
        public int Wisdom { get; }
        public Human(string type, int str, int dex, int chr, int special)
        {
            npcType = type;
            Strength = str;
            Dexterity = dex;
            Charisma = chr;
            Wisdom = special;
        }
        public override string ToString()
        {
            return $"{base.ToString()} " +
                $"My stats are: " +
                $"Strength: {Strength}, " +
                $"Dexterity: {Dexterity}, " +
                $"Charisma: {Charisma}, " +
                $"Wisdom: {Wisdom}";
        }
    }
}
```